<!-- Audio Player Section -->
<section id="exemples" class="relative py-16 md:py-24 mx-6 rounded-[10px] overflow-hidden section-animate" style="background-image: url('media/images/ecouter.webp'); background-size: cover;">
    <!-- Overlay -->
    <div class="absolute inset-0 bg-white/70"></div>
    
    <div class="relative z-10 max-w-[600px] mx-auto px-6">
        <h2 class="text-center mb-4">Écouter des exemples</h2>
        <p class="text-center text-xs md:text-sm text-gray-600 mb-12 font-sans">
            Chaque chanson est unique – voici quelques illustrations de nos créations
        </p>
        
        <!-- Audio Player avec Alpine.js -->
        <div x-data="audioPlayer()">
            <!-- Contrôles principaux -->
            <div class="audio-player-card flex items-center gap-4 mb-8">
                <button 
                    @click="togglePlay()"
                    class="play-button"
                    aria-label="Play/Pause"
                >
                    <span x-show="!isPlaying">▶</span>
                    <span x-show="isPlaying">⏸</span>
                </button>
                
                <div class="flex-1">
                    <div class="font-serif text-base md:text-lg mb-1" x-text="currentTrack.title"></div>
                    <div class="text-xs md:text-sm text-gray-500 font-sans" x-text="currentTrack.artist"></div>
                </div>
            </div>
            
            <!-- Progress bar -->
            <div class="bg-white rounded-[10px] p-4 shadow-sm mb-8">
                <div 
                    @click="seek($event)"
                    class="w-full h-1.5 bg-gray-200 rounded-full cursor-pointer mb-2"
                >
                    <div 
                        class="h-full bg-nottalys-purple rounded-full transition-all duration-100"
                        :style="`width: ${progress}%`"
                    ></div>
                </div>
                
                <div class="flex justify-between text-xs text-gray-500 font-sans">
                    <span x-text="formatTime(currentTime)"></span>
                    <span x-text="formatTime(duration)"></span>
                </div>
            </div>
            
            <!-- Playlist -->
            <div class="space-y-3">
                <template x-for="(track, index) in tracks" :key="index">
                    <div 
                        @click="selectTrack(index)"
                        class="playlist-item flex items-center gap-4"
                        :class="{ 'active': currentIndex === index }"
                    >
                        <div 
                            class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-sans"
                            :class="currentIndex === index ? 'bg-nottalys-purple text-white' : 'bg-gray-100 text-gray-600'"
                        >
                            <span x-text="index + 1"></span>
                        </div>
                        
                        <div class="flex-1">
                            <div class="text-sm font-sans font-medium" x-text="track.title"></div>
                            <div class="text-xs text-gray-500 font-sans" x-text="track.artist"></div>
                        </div>
                    </div>
                </template>
            </div>
            
            <!-- Audio element -->
            <audio 
                x-ref="audio"
                @timeupdate="updateProgress()"
                @loadedmetadata="updateDuration()"
                @ended="handleEnded()"
                preload="metadata"
            ></audio>
        </div>
    </div>
</section>

<script>
function audioPlayer() {
  return {
    tracks: [
      {
        title: "L'Horizon Partagé",
        artist: "Entrée de cérémonie",
        src: "media/audio/examples/L-Horizon-Partage.mp3"
      },
      {
        title: "Tout Le Monde Debout",
        artist: "Ouverture de bal façon TikTok",
        src: "media/audio/examples/Tout-Le-Monde-Debout.mp3"
      },
      {
        title: "Voyage en lumière",
        artist: "Cocktail / fin d'après-midi",
        src: "media/audio/examples/Voyage-en-Lumiere.mp3"
      }
    ],
    currentIndex: 0,
    isPlaying: false,
    currentTime: 0,
    duration: 0,
    progress: 0,
    
    get currentTrack() {
      return this.tracks[this.currentIndex];
    },
    
    init() {
      this.loadTrack(0);
    },
    
    loadTrack(index) {
      this.currentIndex = index;
      const audio = this.$refs.audio;
      audio.src = this.tracks[index].src;
      audio.load();
    },
    
    togglePlay() {
      const audio = this.$refs.audio;
      if (this.isPlaying) {
        audio.pause();
        this.isPlaying = false;
      } else {
        audio.play();
        this.isPlaying = true;
      }
    },
    
    selectTrack(index) {
      if (this.currentIndex === index) {
        this.togglePlay();
      } else {
        this.loadTrack(index);
        setTimeout(() => {
          this.$refs.audio.play();
          this.isPlaying = true;
        }, 100);
      }
    },
    
    updateProgress() {
      const audio = this.$refs.audio;
      this.currentTime = audio.currentTime;
      this.duration = audio.duration || 0;
      this.progress = (this.currentTime / this.duration) * 100 || 0;
    },
    
    updateDuration() {
      this.duration = this.$refs.audio.duration || 0;
    },
    
    seek(event) {
      const rect = event.currentTarget.getBoundingClientRect();
      const percent = (event.clientX - rect.left) / rect.width;
      this.$refs.audio.currentTime = percent * this.duration;
    },
    
    handleEnded() {
      this.isPlaying = false;
      if (this.currentIndex < this.tracks.length - 1) {
        this.selectTrack(this.currentIndex + 1);
      }
    },
    
    formatTime(seconds) {
      if (isNaN(seconds)) return '0:00';
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }
  };
}
</script>