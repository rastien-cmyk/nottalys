<!-- Contact Form Section -->
<section id="commencer" class="py-16 md:py-24 px-6 bg-nottalys-bg-alt section-animate">
    <div class="max-w-[600px] mx-auto">
        
        <div 
            x-data="contactForm()"
            x-init="init()"
        >
            <!-- Header -->
            <div class="text-center mb-12" x-show="!submitted">
                <h2 class="mb-4">Racontez-nous votre histoire</h2>
                <p class="text-sm md:text-base text-gray-600 font-sans">
                    Quelques mots suffisent pour commencer. Nous vous répondrons personnellement.
                </p>
            </div>
            
            <!-- Success Message -->
            <div 
                x-show="submitted"
                x-transition
                class="bg-white rounded-[10px] p-8 md:p-12 shadow-sm text-center"
            >
                <div class="mb-6">
                    <svg class="w-16 h-16 text-green-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                <h3 class="text-2xl md:text-3xl mb-4">Merci pour votre message</h3>
                <p class="text-sm md:text-base text-gray-600 mb-4 font-sans">
                    Nous vous répondrons très rapidement.
                </p>
                <p class="text-sm italic text-gray-500 font-sans">
                    Chaque histoire est unique. Nous prenons le temps de vous lire.
                </p>
            </div>
            
            <!-- Form -->
            <form 
                x-show="!submitted"
                @submit.prevent="submitForm()"
                action="https://formsubmit.co/rastien@gmail.com" 
                method="POST"
                class="bg-white rounded-[10px] p-8 md:p-12 shadow-sm"
            >
                <!-- Prénoms -->
                <div class="mb-6">
                    <label class="block text-xs md:text-sm font-sans font-medium mb-2">
                        Vos prénoms
                    </label>
                    <input 
                        type="text"
                        name="prenoms"
                        x-model="form.prenoms"
                        @input="clearError('prenoms')"
                        class="form-input-nottalys"
                        :class="{ 'error': errors.prenoms }"
                        placeholder="Marie & Thomas"
                        required
                    >
                    <p x-show="errors.prenoms" x-text="errors.prenoms" class="mt-1 text-xs text-red-500"></p>
                </div>
                
                <!-- Email -->
                <div class="mb-6">
                    <label class="block text-xs md:text-sm font-sans font-medium mb-2">
                        Votre adresse email
                    </label>
                    <input 
                        type="email"
                        name="email"
                        x-model="form.email"
                        @input="clearError('email')"
                        class="form-input-nottalys"
                        :class="{ 'error': errors.email }"
                        placeholder="marie.thomas@email.com"
                        required
                    >
                    <p x-show="errors.email" x-text="errors.email" class="mt-1 text-xs text-red-500"></p>
                </div>
                
                <!-- Message -->
                <div class="mb-6">
                    <label class="block text-xs md:text-sm font-sans font-medium mb-2">
                        Parlez-nous de votre histoire, de ce moment, ou simplement de votre envie.
                    </label>
                    <textarea 
                        name="message"
                        x-model="form.message"
                        @input="clearError('message')"
                        rows="5"
                        class="form-input-nottalys resize-none"
                        :class="{ 'error': errors.message }"
                        placeholder="Notre histoire a commencé..."
                        required
                    ></textarea>
                    <p x-show="errors.message" x-text="errors.message" class="mt-1 text-xs text-red-500"></p>
                </div>
                
                <!-- Hidden fields pour FormSubmit -->
                <input type="hidden" name="_captcha" value="false">
                <input type="text" name="_honey" style="display:none">
                
                <!-- Submit Button -->
                <button 
                    type="submit"
                    :disabled="loading"
                    class="w-full btn btn-primary"
                    :class="{ 'opacity-50 cursor-not-allowed': loading }"
                >
                    <span x-show="!loading">Envoyer</span>
                    <span x-show="loading">Envoi en cours...</span>
                </button>
                
                <p class="text-center text-xs md:text-sm text-gray-500 mt-6 font-sans">
                    Aucun engagement. Juste un premier échange.
                </p>
            </form>
        </div>
    </div>
</section>

<script>
function contactForm() {
  return {
    form: {
      prenoms: '',
      email: '',
      message: ''
    },
    errors: {},
    loading: false,
    submitted: false,
    
    init() {
      // Initialisation si nécessaire
    },
    
    clearError(field) {
      delete this.errors[field];
    },
    
    validateForm() {
      this.errors = {};
      
      if (this.form.prenoms.trim().length < 3) {
        this.errors.prenoms = 'Veuillez entrer au moins 3 caractères';
      }
      
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(this.form.email.trim())) {
        this.errors.email = 'Adresse email invalide';
      }
      
      if (this.form.message.trim().length < 50) {
        this.errors.message = 'Veuillez écrire au moins 50 caractères';
      }
      
      return Object.keys(this.errors).length === 0;
    },
    
    async submitForm() {
      if (!this.validateForm()) return;
      
      this.loading = true;
      
      try {
        const formData = new FormData();
        formData.append('prenoms', this.form.prenoms);
        formData.append('email', this.form.email);
        formData.append('message', this.form.message);
        formData.append('_captcha', 'false');
        
        const response = await fetch('https://formsubmit.co/rastien@gmail.com', {
          method: 'POST',
          body: formData,
          headers: {
            'Accept': 'application/json'
          }
        });
        
        if (response.ok) {
          this.submitted = true;
          this.form = { prenoms: '', email: '', message: '' };
          
          // Scroll vers le message de succès
          setTimeout(() => {
            document.querySelector('#commencer').scrollIntoView({ 
              behavior: 'smooth',
              block: 'center'
            });
          }, 100);
        } else {
          this.errors.general = 'Une erreur est survenue. Merci de réessayer.';
        }
      } catch (error) {
        console.error('Erreur:', error);
        this.errors.general = 'Erreur de connexion. Veuillez réessayer.';
      } finally {
        this.loading = false;
      }
    }
  };
}
</script>